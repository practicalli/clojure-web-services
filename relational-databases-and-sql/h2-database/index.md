# H2 Relational Database
[H2](http://www.h2database.com/) is a database distributed as library, making it a ideal for a self-contained development environment for a Clojure application with a relational database. Data is persisted to `mv.db` files as SQL queries are executed in Clojure.

![Clojure WebApps - H2 relational database embedded in a Clojure REPL for a self contained development environment](https://raw.githubusercontent.com/practicalli/graphic-design/live/practicalli-clojure-webapps-database-h2-embedded.png)

H2 database  main features include
* Very fast, open source, JDBC API
* Embedded and server modes; in-memory databases
* Browser based Console application
* Small footprint: around 2 MB jar file size

Whilst H2 could be used for very small production web applications, it is recommended only as a development time database.

## Using h2 in the REPL
H2 works with `next.jdbc`, the defacto relational database library for Clojure.


## Including H2 in Clojure projects

`next.jdbc` is highly recommended library for SQL queries in Clojure

{% tabs deps="deps.edn projects", lein="Leiningnen projects" %}

{% content "deps" %}
To use H2 database as only a development database, add an `:extra-deps` entry to include the H2 library in a `:dev` alias in the project `deps.edn` file.

```clojure
{:deps
 {org.clojure/clojure    {:mvn/version "1.10.1"}
 org.seancorfield/next.jdbc {:mvn/version "1.1.569"}}}

{:aliases
  {:dev
   {:extra-deps {com.h2database/h2 {:mvn/version "1.4.200"}}}}}
```

Alternative, if using [`practicalli/clojure-deps-edn`](http://practicalli.github.io/clojure/clojure-tools/install/install-clojure.html#clojure-cli-tools-common-aliases) configuration, use the `:database-h2` alias when starting the REPL to include the H2 library on the class path.


{% content "lein" %}

Edit the `project.clj` configuration file and add the H2 library to the :dev-dependencies section to run H2 as the development only database.

```clojure
(defproject project-name "1.0-SNAPSHOT"
  :description "Database application using next.jdbc with H2 as development database"
  :url "http://practicalli.github.io/clojure/"
  :dependencies [[org.clojure/clojure "1.10.1"]
                 [seancorfield/next.jdbc "1.1.582"]]

  :dev-depencencies [[com.h2database/h2 "1.4.200"]])
```

{% endtabs %}



## Auto-increment values in H2 database
The `IDENTITY` type is used for automatically generating an incrementing 64-bit long integer in H2 database.

```sql
CREATE TABLE public.account (
  id IDENTITY NOT NULL PRIMARY KEY ,
  name VARCHAR NOT NULL,
  number VARCHAR NOT NULL,
  sortcode VARCHAR NOT NULL,
  created TIMESTAMP WITH TIME ZONE NOT NULL);
```

No need to pass a value for our pkey column value as it is being automatically generated by H2.

```sql
INSERT INTO public.account ( id, name, number, sortcode, created)
VALUES ( ? , ? , ? , ? );
```



<!-- Old style auto-increment -->

<!-- ```sql -->
<!-- create table test(id bigint auto_increment, name varchar(255)); -->
<!-- insert into test(name) values('hello'); -->
<!-- insert into test(name) values('world'); -->
<!-- select * from test; -->
<!-- ``` -->


## References
* [H2 Database website](http://www.h2database.com/)






## Resources
* [next.jdbc](https://cljdoc.org/d/seancorfield/next.jdbc/) documentation and [next.jdbc db-types list](https://github.com/seancorfield/next-jdbc/blob/develop/src/next/jdbc/connection.clj#L52-L123)
* [H2 Database website](http://www.h2database.com/)
* [SQL Constraints - W3Schools.com](https://www.w3schools.com/sql/sql_constraints.asp)
* [Purpose of contraint naming - Stack Overflow](https://stackoverflow.com/questions/1397440/what-is-the-purpose-of-constraint-naming)
* [seancorfield/honeysql](https://github.com/seancorfield/honeysql) - SQL as data structures
* [stack overflow - auto increment id in h2 database](https://stackoverflow.com/questions/9353167/auto-increment-id-in-h2-database)
