
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deployment via CI to Heroku Â· Practicalli Clojure WebApps</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Practicalli">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-callouts/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-folding-chapters/folding-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-newtabs/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-newtabs/tabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-simpletabs/tabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-terminull-light/terminull.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-wide-page/wide.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="unit-tests.html" />
    
    
    <link rel="prev" href="deployment-pipeline.html" />
    

    </head>
    <body>
        


<div class="book">
    <div class="book-summary">
        
      <!-- <div class="theme-code-header">
           <a href="" class="link">
           <h1 class="title">Practicalli Clojure WebApps</h1>
           </a>
           </div> -->
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://practicalli.github.io" target="_blank" class="custom-link">Practical.li</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                  <!--  -->
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../">
            
                <a href="../../">
            
                  <!--  -->
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../content-plan.html">
            
                <a href="../../content-plan.html">
            
                  <!--  -->
                    Content Plan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../requirements.html">
            
                <a href="../../requirements.html">
            
                  <!--  -->
                    Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../overview/webapps-in-clojure.html">
            
                <a href="../../overview/webapps-in-clojure.html">
            
                  <!--  -->
                    Theory: WebApps in Clojure
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Clojure CLI Projects</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../status-monitor-deps/">
            
                <a href="../status-monitor-deps/">
            
                  <!--  -->
                    Status Monitor - deps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../status-monitor-deps/application-server.html">
            
                <a href="../status-monitor-deps/application-server.html">
            
                  <!--  -->
                    Application server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../status-monitor-deps/debugging-requests.html">
            
                <a href="../status-monitor-deps/debugging-requests.html">
            
                  <!--  -->
                    Debug requests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../status-monitor-deps/unit-test-mocking-handlers.html">
            
                <a href="../status-monitor-deps/unit-test-mocking-handlers.html">
            
                  <!--  -->
                    Unit Test & Mocking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../status-monitor-deps/refactor-handlers-and-tests.html">
            
                <a href="../status-monitor-deps/refactor-handlers-and-tests.html">
            
                  <!--  -->
                    Defining handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../status-monitor-deps/continuous-integration.html">
            
                <a href="../status-monitor-deps/continuous-integration.html">
            
                  <!--  -->
                    Continuous integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="../status-monitor-deps/deployment-via-ci.html">
            
                <a href="../status-monitor-deps/deployment-via-ci.html">
            
                  <!--  -->
                    Deployment via CI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="./">
            
                <a href="./">
            
                  <!--  -->
                    Banking on Clojure - deps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="application-server-configuration.html">
            
                <a href="application-server-configuration.html">
            
                  <!--  -->
                    App Server Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="refactor-handler.html">
            
                <a href="refactor-handler.html">
            
                  <!--  -->
                    Refactor handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="defining-handlers.html">
            
                <a href="defining-handlers.html">
            
                  <!--  -->
                    Defining handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="continuous-integration.html">
            
                <a href="continuous-integration.html">
            
                  <!--  -->
                    Continous Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="deployment-pipeline.html">
            
                <a href="deployment-pipeline.html">
            
                  <!--  -->
                    Deployment Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2.6" data-path="deployment-via-ci.html">
            
                <a href="deployment-via-ci.html">
            
                  <!--  -->
                    Deployment via CI to Heroku
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" data-path="unit-tests.html">
            
                <a href="unit-tests.html">
            
                  <!--  -->
                    Unit Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" data-path="spec-generative-testing.html">
            
                <a href="spec-generative-testing.html">
            
                  <!--  -->
                    Clojure Specs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.9" data-path="development-database.html">
            
                <a href="development-database.html">
            
                  <!--  -->
                    Development database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.10" data-path="instrument-next-jdbc-functions.html">
            
                <a href="instrument-next-jdbc-functions.html">
            
                  <!--  -->
                    Instrument next.jdbc functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.11" data-path="database-tables.html">
            
                <a href="database-tables.html">
            
                  <!--  -->
                    Database tables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12" data-path="database-queries.html">
            
                <a href="database-queries.html">
            
                  <!--  -->
                    Database queries
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.12.1" data-path="create-records.html">
            
                <a href="create-records.html">
            
                  <!--  -->
                    Create Records
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12.2" data-path="read-records.html">
            
                <a href="read-records.html">
            
                  <!--  -->
                    Read Records
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12.3" data-path="update-records.html">
            
                <a href="update-records.html">
            
                  <!--  -->
                    Update Records
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.12.4" data-path="delete-records.html">
            
                <a href="delete-records.html">
            
                  <!--  -->
                    Delete Records
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.13" data-path="cyclic-load-dependency.html">
            
                <a href="cyclic-load-dependency.html">
            
                  <!--  -->
                    Cyclic Load Dependency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.14" data-path="clojure-spec-generate-mock-data.html">
            
                <a href="clojure-spec-generate-mock-data.html">
            
                  <!--  -->
                    Spec: generate database data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.15" data-path="unit-testing-the-database.html">
            
                <a href="unit-testing-the-database.html">
            
                  <!--  -->
                    Unit Testing Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.16" data-path="honeysql.html">
            
                <a href="honeysql.html">
            
                  <!--  -->
                    HoneySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.17" data-path="namespace-design.html">
            
                <a href="namespace-design.html">
            
                  <!--  -->
                    Namespace design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.18" data-path="production-database.html">
            
                <a href="production-database.html">
            
                  <!--  -->
                    Production database
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">REPL Driven Development</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../repl-driven-development/">
            
                <a href="../../repl-driven-development/">
            
                  <!--  -->
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../repl-driven-development/integrant-repl/">
            
                <a href="../../repl-driven-development/integrant-repl/">
            
                  <!--  -->
                    integrant REPL
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Architectural Components</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../app-servers/">
            
                <a href="../../app-servers/">
            
                  <!--  -->
                    Application servers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../app-servers/basic-configuration.html">
            
                <a href="../../app-servers/basic-configuration.html">
            
                  <!--  -->
                    Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1.1" data-path="../../app-servers/java-system-properties.html">
            
                <a href="../../app-servers/java-system-properties.html">
            
                  <!--  -->
                    Java Properties
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../app-servers/simple-restart.html">
            
                <a href="../../app-servers/simple-restart.html">
            
                  <!--  -->
                    Simple restart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../../app-servers/atom-based-restart.html">
            
                <a href="../../app-servers/atom-based-restart.html">
            
                  <!--  -->
                    Atom based restart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../../app-servers/app-server-logging.html">
            
                <a href="../../app-servers/app-server-logging.html">
            
                  <!--  -->
                    Logging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../application-logic/">
            
                <a href="../../application-logic/">
            
                  <!--  -->
                    Application logic
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../application-logic/routing.html">
            
                <a href="../../application-logic/routing.html">
            
                  <!--  -->
                    Routing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../relational-databases-and-sql/">
            
                <a href="../../relational-databases-and-sql/">
            
                  <!--  -->
                    Relational Database & SQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../relational-databases-and-sql/next-jdbc-library/">
            
                <a href="../../relational-databases-and-sql/next-jdbc-library/">
            
                  <!--  -->
                    next.jdbc library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../../relational-databases-and-sql/h2-database/">
            
                <a href="../../relational-databases-and-sql/h2-database/">
            
                  <!--  -->
                    H2 Database
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.2.1" data-path="../../relational-databases-and-sql/h2-database/schema-design.html">
            
                <a href="../../relational-databases-and-sql/h2-database/schema-design.html">
            
                  <!--  -->
                    H2 schema design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.2" data-path="../../relational-databases-and-sql/h2-database/database-tools.html">
            
                <a href="../../relational-databases-and-sql/h2-database/database-tools.html">
            
                  <!--  -->
                    H2 database tools
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../../relational-databases-and-sql/postgresql-database.html">
            
                <a href="../../relational-databases-and-sql/postgresql-database.html">
            
                  <!--  -->
                    PostgreSQL Database
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.3.1" data-path="../../relational-databases-and-sql/managing-connections.html">
            
                <a href="../../relational-databases-and-sql/managing-connections.html">
            
                  <!--  -->
                    Managing Connections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Leiningen Projects</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../leiningen/todo-app/">
            
                <a href="../leiningen/todo-app/">
            
                  <!--  -->
                    TODO WebApp
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../leiningen/todo-app/create-a-project/">
            
                <a href="../leiningen/todo-app/create-a-project/">
            
                  <!--  -->
                    Create a Project
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1.1" data-path="../leiningen/todo-app/create-a-project/update-project-details.html">
            
                <a href="../leiningen/todo-app/create-a-project/update-project-details.html">
            
                  <!--  -->
                    Update Project details
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../leiningen/todo-app/create-a-webserver-with-ring/">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/">
            
                  <!--  -->
                    Create a webserver with Ring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.1" data-path="../leiningen/todo-app/create-a-webserver-with-ring/add-ring-dependency.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/add-ring-dependency.html">
            
                  <!--  -->
                    Add Ring Dependency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.2" data-path="../leiningen/todo-app/create-a-webserver-with-ring/configure-main-namespace.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/configure-main-namespace.html">
            
                  <!--  -->
                    Configure main namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3" data-path="../leiningen/todo-app/create-a-webserver-with-ring/namespaces.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/namespaces.html">
            
                  <!--  -->
                    Theory: namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.4" data-path="../leiningen/todo-app/create-a-webserver-with-ring/include-ring-library.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/include-ring-library.html">
            
                  <!--  -->
                    Include Ring Library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.5" data-path="../leiningen/todo-app/create-a-webserver-with-ring/add-a-jetty-webserver.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/add-a-jetty-webserver.html">
            
                  <!--  -->
                    Add a Jetty webserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.6" data-path="../leiningen/todo-app/create-a-webserver-with-ring/coersing-types-and-java-lang.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/coersing-types-and-java-lang.html">
            
                  <!--  -->
                    Theory: Coersing Types & java.lang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.7" data-path="../leiningen/todo-app/create-a-webserver-with-ring/run-webserver.html">
            
                <a href="../leiningen/todo-app/create-a-webserver-with-ring/run-webserver.html">
            
                  <!--  -->
                    Run webserver
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../leiningen/todo-app/introducing-ring/">
            
                <a href="../leiningen/todo-app/introducing-ring/">
            
                  <!--  -->
                    Theory: Introducing Ring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../leiningen/todo-app/create-a-handler-function/">
            
                <a href="../leiningen/todo-app/create-a-handler-function/">
            
                  <!--  -->
                    Create a handler function
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.4.1" data-path="../leiningen/todo-app/create-a-handler-function/add-not-found.html">
            
                <a href="../leiningen/todo-app/create-a-handler-function/add-not-found.html">
            
                  <!--  -->
                    Add error for bad routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4.2" data-path="../leiningen/todo-app/create-a-handler-function/if-function.html">
            
                <a href="../leiningen/todo-app/create-a-handler-function/if-function.html">
            
                  <!--  -->
                    Theory: if function
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4.3" data-path="../leiningen/todo-app/create-a-handler-function/maps-and-keywords.html">
            
                <a href="../leiningen/todo-app/create-a-handler-function/maps-and-keywords.html">
            
                  <!--  -->
                    Theory: maps and keywords
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../leiningen/todo-app/unit-test-handler-function/">
            
                <a href="../leiningen/todo-app/unit-test-handler-function/">
            
                  <!--  -->
                    Unit test handler function
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../leiningen/todo-app/reloading-the-application/">
            
                <a href="../leiningen/todo-app/reloading-the-application/">
            
                  <!--  -->
                    Reloading the application
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.6.1" data-path="../leiningen/todo-app/reloading-the-application/test-your-code-reloads.html">
            
                <a href="../leiningen/todo-app/reloading-the-application/test-your-code-reloads.html">
            
                  <!--  -->
                    Test your code reloads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6.2" data-path="../leiningen/todo-app/reloading-the-application/middleware.html">
            
                <a href="../leiningen/todo-app/reloading-the-application/middleware.html">
            
                  <!--  -->
                    Middleware in Ring
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.7" data-path="../leiningen/todo-app/compojure/">
            
                <a href="../leiningen/todo-app/compojure/">
            
                  <!--  -->
                    Compojure
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.7.1" data-path="../leiningen/todo-app/compojure/theory-routing.html">
            
                <a href="../leiningen/todo-app/compojure/theory-routing.html">
            
                  <!--  -->
                    Theory: routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.2" data-path="../leiningen/todo-app/compojure/adding-dependency.html">
            
                <a href="../leiningen/todo-app/compojure/adding-dependency.html">
            
                  <!--  -->
                    Adding dependency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.3" data-path="../leiningen/todo-app/compojure/using-compojure.html">
            
                <a href="../leiningen/todo-app/compojure/using-compojure.html">
            
                  <!--  -->
                    Using Compojure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.4" data-path="../leiningen/todo-app/compojure/adding-goodbye-route.html">
            
                <a href="../leiningen/todo-app/compojure/adding-goodbye-route.html">
            
                  <!--  -->
                    Adding goodbye route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.5" data-path="../leiningen/todo-app/compojure/about.html">
            
                <a href="../leiningen/todo-app/compojure/about.html">
            
                  <!--  -->
                    About route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.6" data-path="../leiningen/todo-app/compojure/show-request-info.html">
            
                <a href="../leiningen/todo-app/compojure/show-request-info.html">
            
                  <!--  -->
                    Show request info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.7" data-path="../leiningen/todo-app/compojure/variable-path-elements.html">
            
                <a href="../leiningen/todo-app/compojure/variable-path-elements.html">
            
                  <!--  -->
                    Variable Path Elements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.8" data-path="../leiningen/todo-app/compojure/theory-local-name-bindings.html">
            
                <a href="../leiningen/todo-app/compojure/theory-local-name-bindings.html">
            
                  <!--  -->
                    Theory: local name bindings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.9" data-path="../leiningen/todo-app/compojure/theory-using-hash-maps.html">
            
                <a href="../leiningen/todo-app/compojure/theory-using-hash-maps.html">
            
                  <!--  -->
                    Theory: using Clojure hash-maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.7.10" data-path="../leiningen/todo-app/compojure/lisp-calculator.html">
            
                <a href="../leiningen/todo-app/compojure/lisp-calculator.html">
            
                  <!--  -->
                    Lisp Calculator
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.8" data-path="../leiningen/todo-app/heroku/">
            
                <a href="../leiningen/todo-app/heroku/">
            
                  <!--  -->
                    Deploying to Heroku
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.8.1" data-path="../leiningen/todo-app/heroku/update-project.html">
            
                <a href="../leiningen/todo-app/heroku/update-project.html">
            
                  <!--  -->
                    Update the project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.8.2" data-path="../leiningen/todo-app/heroku/procfile.html">
            
                <a href="../leiningen/todo-app/heroku/procfile.html">
            
                  <!--  -->
                    Add Procfile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.8.3" data-path="../leiningen/todo-app/heroku/deploy.html">
            
                <a href="../leiningen/todo-app/heroku/deploy.html">
            
                  <!--  -->
                    Deploy to Heroku
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.9" data-path="../leiningen/todo-app/hiccup/">
            
                <a href="../leiningen/todo-app/hiccup/">
            
                  <!--  -->
                    Hiccup HTML library
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.9.1" data-path="../leiningen/todo-app/hiccup/updating-handlers-with-hiccup.html">
            
                <a href="../leiningen/todo-app/hiccup/updating-handlers-with-hiccup.html">
            
                  <!--  -->
                    Updating handlers with hiccup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.9.2" data-path="../leiningen/todo-app/hiccup/create-new-handler.html">
            
                <a href="../leiningen/todo-app/hiccup/create-new-handler.html">
            
                  <!--  -->
                    Create a new handler
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.10" data-path="../leiningen/todo-app/refactor-namespace/">
            
                <a href="../leiningen/todo-app/refactor-namespace/">
            
                  <!--  -->
                    Refactor namespace
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.10.1" data-path="../leiningen/todo-app/refactor-namespace/base-routes.html">
            
                <a href="../leiningen/todo-app/refactor-namespace/base-routes.html">
            
                  <!--  -->
                    Base routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.10.2" data-path="../leiningen/todo-app/refactor-namespace/core.html">
            
                <a href="../leiningen/todo-app/refactor-namespace/core.html">
            
                  <!--  -->
                    Refactored Core
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.11" data-path="../leiningen/todo-app/postgres/">
            
                <a href="../leiningen/todo-app/postgres/">
            
                  <!--  -->
                    Postgres Database
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.11.1" data-path="../leiningen/todo-app/postgres/install.html">
            
                <a href="../leiningen/todo-app/postgres/install.html">
            
                  <!--  -->
                    Postgres install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.2" data-path="../leiningen/todo-app/postgres/environment-variables.html">
            
                <a href="../leiningen/todo-app/postgres/environment-variables.html">
            
                  <!--  -->
                    Environment Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.3" data-path="../leiningen/todo-app/postgres/postgres-cli.html">
            
                <a href="../leiningen/todo-app/postgres/postgres-cli.html">
            
                  <!--  -->
                    Postgres CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.4" data-path="../leiningen/todo-app/postgres/dataclips.html">
            
                <a href="../leiningen/todo-app/postgres/dataclips.html">
            
                  <!--  -->
                    Dataclips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.5" data-path="../leiningen/todo-app/connect-to-postgres/">
            
                <a href="../leiningen/todo-app/connect-to-postgres/">
            
                  <!--  -->
                    Connect to Postgres
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.11.5.1" data-path="../leiningen/todo-app/connect-to-postgres/add-database-dependencies.html">
            
                <a href="../leiningen/todo-app/connect-to-postgres/add-database-dependencies.html">
            
                  <!--  -->
                    Add Database Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.5.2" data-path="../leiningen/todo-app/connect-to-postgres/define-db-connection.html">
            
                <a href="../leiningen/todo-app/connect-to-postgres/define-db-connection.html">
            
                  <!--  -->
                    Define Database Connection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.11.6" data-path="../leiningen/todo-app/database-model/">
            
                <a href="../leiningen/todo-app/database-model/">
            
                  <!--  -->
                    Creating a database model
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.11.6.1" data-path="../leiningen/todo-app/database-model/create-table.html">
            
                <a href="../leiningen/todo-app/database-model/create-table.html">
            
                  <!--  -->
                    Create table
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.6.2" data-path="../leiningen/todo-app/database-model/create-task.html">
            
                <a href="../leiningen/todo-app/database-model/create-task.html">
            
                  <!--  -->
                    Create task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.6.3" data-path="../leiningen/todo-app/database-model/show-all-task.html">
            
                <a href="../leiningen/todo-app/database-model/show-all-task.html">
            
                  <!--  -->
                    List tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.6.4" data-path="../leiningen/todo-app/database-model/delete-task.html">
            
                <a href="../leiningen/todo-app/database-model/delete-task.html">
            
                  <!--  -->
                    Delete task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.6.5" data-path="../leiningen/todo-app/database-model/alternative-approaches.html">
            
                <a href="../leiningen/todo-app/database-model/alternative-approaches.html">
            
                  <!--  -->
                    Alternative approaches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.11.7" data-path="../leiningen/todo-app/task-handlers/">
            
                <a href="../leiningen/todo-app/task-handlers/">
            
                  <!--  -->
                    Task handlers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.11.7.1" data-path="../leiningen/todo-app/task-handlers/add-a-task.html">
            
                <a href="../leiningen/todo-app/task-handlers/add-a-task.html">
            
                  <!--  -->
                    Add a task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.7.2" data-path="../leiningen/todo-app/task-handlers/show-task.html">
            
                <a href="../leiningen/todo-app/task-handlers/show-task.html">
            
                  <!--  -->
                    Show tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.11.7.3" data-path="../leiningen/todo-app/task-handlers/delete-a-task.html">
            
                <a href="../leiningen/todo-app/task-handlers/delete-a-task.html">
            
                  <!--  -->
                    Delete a task
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Building API's</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../server-side-api/">
            
                <a href="../../server-side-api/">
            
                  <!--  -->
                    Server-side API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.1" data-path="../../server-side-api/compojure-api-template.html">
            
                <a href="../../server-side-api/compojure-api-template.html">
            
                  <!--  -->
                    Compojure-API template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.2" data-path="../../server-side-api/create-compojure-api-project.html">
            
                <a href="../../server-side-api/create-compojure-api-project.html">
            
                  <!--  -->
                    Create API project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.3" data-path="../../server-side-api/swagger.html">
            
                <a href="../../server-side-api/swagger.html">
            
                  <!--  -->
                    Swagger
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.3.1" data-path="../../server-side-api/ring-swagger.html">
            
                <a href="../../server-side-api/ring-swagger.html">
            
                  <!--  -->
                    ring-swagger
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.1.4" data-path="../../server-side-api/plumatic-schema.html">
            
                <a href="../../server-side-api/plumatic-schema.html">
            
                  <!--  -->
                    Plumatic Schema
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.5" data-path="../../server-side-api/json-files.html">
            
                <a href="../../server-side-api/json-files.html">
            
                  <!--  -->
                    JSON files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.6" data-path="../../server-side-api/testing-api.html">
            
                <a href="../../server-side-api/testing-api.html">
            
                  <!--  -->
                    Testing an API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.6.1" data-path="../../server-side-api/ring-mock.html">
            
                <a href="../../server-side-api/ring-mock.html">
            
                  <!--  -->
                    ring-mock library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.6.2" data-path="../../server-side-api/cheshire.html">
            
                <a href="../../server-side-api/cheshire.html">
            
                  <!--  -->
                    cheshire library
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.1.7" data-path="../../server-side-api/end-to-end-testing/">
            
                <a href="../../server-side-api/end-to-end-testing/">
            
                  <!--  -->
                    End to End Testing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.7.1" data-path="../../server-side-api/end-to-end-testing/swagger.html">
            
                <a href="../../server-side-api/end-to-end-testing/swagger.html">
            
                  <!--  -->
                    Swagger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.7.2" data-path="../../server-side-api/end-to-end-testing/curl.html">
            
                <a href="../../server-side-api/end-to-end-testing/curl.html">
            
                  <!--  -->
                    Curl
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.7.3" data-path="../../server-side-api/end-to-end-testing/insomnia.html">
            
                <a href="../../server-side-api/end-to-end-testing/insomnia.html">
            
                  <!--  -->
                    Insomnia
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.7.4" data-path="../../server-side-api/end-to-end-testing/postman.html">
            
                <a href="../../server-side-api/end-to-end-testing/postman.html">
            
                  <!--  -->
                    Postman Client
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.1.8" data-path="../../server-side-api/terminology.html">
            
                <a href="../../server-side-api/terminology.html">
            
                  <!--  -->
                    Terminology
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../server-side-api/projects/game-scoreboard/">
            
                <a href="../../server-side-api/projects/game-scoreboard/">
            
                  <!--  -->
                    Project: Game Scoreboard
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.2.1" data-path="../../server-side-api/projects/game-scoreboard/defining-scoreboard.html">
            
                <a href="../../server-side-api/projects/game-scoreboard/defining-scoreboard.html">
            
                  <!--  -->
                    Defining scoreboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.2" data-path="../../server-side-api/projects/game-scoreboard/defining-scores.html">
            
                <a href="../../server-side-api/projects/game-scoreboard/defining-scores.html">
            
                  <!--  -->
                    Defining Players
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.3" data-path="../../server-side-api/projects/game-scoreboard-ui/">
            
                <a href="../../server-side-api/projects/game-scoreboard-ui/">
            
                  <!--  -->
                    Game Scoreboard UI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../persistent-data-structures/">
            
                <a href="../../persistent-data-structures/">
            
                  <!--  -->
                    Theory: Persistent Data Structures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../../persistent-data-structures/lists.html">
            
                <a href="../../persistent-data-structures/lists.html">
            
                  <!--  -->
                    Theory: Lists
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../../persistent-data-structures/maps.html">
            
                <a href="../../persistent-data-structures/maps.html">
            
                  <!--  -->
                    Theory: Maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../../persistent-data-structures/vectors.html">
            
                <a href="../../persistent-data-structures/vectors.html">
            
                  <!--  -->
                    Theory: Vectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.4" data-path="../../persistent-data-structures/sets.html">
            
                <a href="../../persistent-data-structures/sets.html">
            
                  <!--  -->
                    Theory: Sets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../../reference/ring/">
            
                <a href="../../reference/ring/">
            
                  <!--  -->
                    Ring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.2.1" data-path="../../reference/ring/request-map.html">
            
                <a href="../../reference/ring/request-map.html">
            
                  <!--  -->
                    request map
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Hacking on content</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../../project-url-shortner/">
            
                <a href="../../project-url-shortner/">
            
                  <!--  -->
                    Project: URL Shortner as a Service
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1.1" data-path="../../project-url-shortner/create-project.html">
            
                <a href="../../project-url-shortner/create-project.html">
            
                  <!--  -->
                    Create project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.2" data-path="../../project-url-shortner/run-project.html">
            
                <a href="../../project-url-shortner/run-project.html">
            
                  <!--  -->
                    Run project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.3" data-path="../../project-url-shortner/test-app-reloading.html">
            
                <a href="../../project-url-shortner/test-app-reloading.html">
            
                  <!--  -->
                    Test app reloading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.4" data-path="../../project-url-shortner/compojure-template.html">
            
                <a href="../../project-url-shortner/compojure-template.html">
            
                  <!--  -->
                    Compojure Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.5" data-path="../../project-url-shortner/design-data-structure.html">
            
                <a href="../../project-url-shortner/design-data-structure.html">
            
                  <!--  -->
                    Design data structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.6" data-path="../../project-url-shortner/whats-in-a-request.html">
            
                <a href="../../project-url-shortner/whats-in-a-request.html">
            
                  <!--  -->
                    Whats in a request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.1.7" data-path="../../project-url-shortner/redirect-to-full-url.html">
            
                <a href="../../project-url-shortner/redirect-to-full-url.html">
            
                  <!--  -->
                    Redirect to full URL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="" target="_blank" class="gitbook-link">
            Author: Practicalli
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Deployment via CI to Heroku</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="deployment-via-continuous-integration">Deployment via Continuous Integration</h1>
<p>Deployment will be via a workflow to the CircleCI configuration that deploys the application to a staging environment on successful completion of running all tests in the project.  Once the staging application is approved, the application build can be promoted to production.</p>
<p><img src="../../images/circleci-workflow-sequential-git-heroku.png" alt="Deployment workflow"></p>
<h2 id="add-heroku-orb-to-circleci-configuration">Add Heroku orb to CircleCI configuration</h2>
<p>Edit <code>.circleci/config.yml</code> and add the <a href="https://circleci.com/orbs/registry/orb/circleci/heroku" target="_blank">heroku orb</a> and a workflow to Heroku.  The workflow has a dependency on the build job, so that will take place first.</p>
<p>The Heroku workflow will build the application from source code using the <code>heroku/deploy-via-git</code>.  Only changes pushed to the <code>live</code> branch of the GitHub repository will be used in the Heroku deploy workflow.</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2.1</span>  <span class="token comment"># circleci configuration version</span>

<span class="token key atrule">orbs</span><span class="token punctuation">:</span>
  <span class="token key atrule">kaocha</span><span class="token punctuation">:</span> lambdaisland/kaocha@0.0.1 <span class="token comment"># Org settings &gt; Security &gt; uncertified orbs</span>
  <span class="token key atrule">heroku</span><span class="token punctuation">:</span> circleci/heroku@1.1.1 <span class="token comment"># Invoke the Heroku orb</span>

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">heroku_deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
      <span class="token punctuation">-</span> <span class="token key atrule">heroku/deploy-via-git</span><span class="token punctuation">:</span> <span class="token comment"># Use the pre-configured job, deploy-via-git</span>
          <span class="token key atrule">requires</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> build
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token key atrule">branches</span><span class="token punctuation">:</span>
              <span class="token key atrule">only</span><span class="token punctuation">:</span> live

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>    <span class="token comment"># basic units of work in a run</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span> <span class="token comment"># runs not using Workflows must have a `build` job as entry point</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/build <span class="token comment"># directory where steps will run</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>                                                      <span class="token comment"># run the steps with Docker</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> circleci/clojure<span class="token punctuation">:</span>openjdk<span class="token punctuation">-</span>11<span class="token punctuation">-</span>tools<span class="token punctuation">-</span>deps<span class="token punctuation">-</span>1.10.1.727 <span class="token comment"># image is primary container where `steps` are run</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>            <span class="token comment"># environment variables for primary container</span>
      <span class="token key atrule">JVM_OPTS</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>Xmx3200m   <span class="token comment"># limit the maximum heap size to prevent out of memory errors</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>             <span class="token comment"># commands that comprise the `build` job</span>
      <span class="token punctuation">-</span> checkout       <span class="token comment"># check out source code to working directory</span>
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span> <span class="token comment"># restores saved cache if checksum hasn&apos;t changed since the last run</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> banking<span class="token punctuation">-</span>on<span class="token punctuation">-</span>clojure<span class="token punctuation">-</span>webapp<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;deps.edn&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> clojure <span class="token punctuation">-</span>R<span class="token punctuation">:</span>test<span class="token punctuation">:</span>runner <span class="token punctuation">-</span>Spath
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>    <span class="token comment"># generate and store cache in the .m2 directory using a key template</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ~/.m2
            <span class="token punctuation">-</span> ~/.gitlibs
          <span class="token key atrule">key</span><span class="token punctuation">:</span> banking<span class="token punctuation">-</span>on<span class="token punctuation">-</span>clojure<span class="token punctuation">-</span>webapp<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;deps.edn&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bin/kaocha <span class="token punctuation">-</span><span class="token punctuation">-</span>reporter kaocha.report/documentation <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>randomize <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>color <span class="token punctuation">-</span><span class="token punctuation">-</span>plugin kaocha.plugin.alpha/spec<span class="token punctuation">-</span>test<span class="token punctuation">-</span>check
</code></pre>
<h2 id="add-depstar-to-build-an-uberjar">Add depstar to build an uberjar</h2>
<p>The depstar tool creates a Java archive (jar) package of the application.  The <code>deps.edn</code> configuration in the root of the project already contains an <code>uberjar</code> alias for this tool.</p>
<p>Check the project builds the uberjar locally:</p>
<pre class="language-"><code class="lang-bash">clojure -A:uberjar
</code></pre>
<p>This will be the same command used in the build script</p>
<h2 id="create-a-custom-build-behaviour">Create a custom build behaviour</h2>
<p>Heroku build scripts use Leiningen by default.  Configure Heroku to build with Clojure Tools, create a custom build file which will run instead of Leiningen.</p>
<p>Create a file called <code>bin/build</code> script in the root of the project</p>
<pre class="language-"><code class="lang-bash"><span class="token shebang important">#!/usr/bin/env bash</span>
clojure -A:uberjar
</code></pre>
<p>Create an empty <code>project.clj</code> file so that Heroku recognized the project as Clojure.</p>
<h2 id="define-how-to-run-the-application">Define how to run the application</h2>
<p>Create a <code>Procfile</code> file in the root of the project directory containing the command to run the application.</p>
<p>Use the <code>$PORT</code> as an argument to the command.  Heroku automatically asignes a port number for an application to listen upon when creating a contain in which the application will run.  This port number is set using the <code>PORT</code> environment variable and is available to the application on startup.  Using the PORT environment variable ensures the Clojure application will recieve requests.</p>
<pre class="language-"><code class="lang-bash">web: java -jar banking-on-clojure.jar <span class="token variable">$PORT</span>
</code></pre>
<h2 id="specifying-a-java-version">Specifying a Java version</h2>
<p>Create a <code>system.properties</code> and specify the Java version to use for the application. Java 1.8 is the default version use on Heroku, however, our development environment is Java 11, so add a property to set the Java runtime to version 11.</p>
<pre class="language-"><code class="lang-properties"><span class="token attr-name">java.runtime.version</span><span class="token punctuation">=</span><span class="token attr-value">11</span>
</code></pre>
<h2 id="circleci-environment-variables">CircleCI Environment Variables</h2>
<p>Open the CircleCI and select project settings &gt; Environment Variables</p>
<p>Add environment variables to define where the Heroku application can be found and a token to provide access.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>HEROKU_API_KEY</td>
<td>name of the application created on Heroku</td>
</tr>
<tr>
<td>HEROKU_APP_NAME</td>
<td>API key found in Account Settings &gt; API Key</td>
</tr>
</tbody>
</table>
<h2 id="heroku-pipeline-configuration">Heroku Pipeline configuration</h2>
<p>Login to the Heroku dashboard and create a new pipeline called <code>banking-on-clojure-webapp</code></p>
<p>In the Heroku dashboard, open the application Settings and add a Config Vars using the name <code>CLOJURE_CLI_VERSION</code> with a value of <code>1.10.1.727</code></p>
<p><img src="../../images/heroku-dashboard-status-monitor-config-vars-clojure-cli-version.png" alt="Heroku dashboard - Settings - Config Vars - Clojure CLI version"></p>
<p>Using Heroku Pipelines the staging environment is promoted to production rather than being rebuilt</p>
<p><img src="https://raw.githubusercontent.com/jr0cket/developer-guides/master/heroku-pipelines-staging-production.png" alt="Heroku Pipeline concept - staging and production"></p>
<p>The Heroku dashboard can be used to promote the application into production, once the staging application is signed off.</p>
<p><img src="../../images/heroku-pipeline-banking-on-clojure.png" alt="Heroku Pipeline banking-on-clojure"></p>
<h2 id="push-changes-to-trigger-build">Push changes to trigger build</h2>
<p>Commit the changed and push them to the GitHub repository.  This triggers a build by CircleCI.  The build downloads the dependencies and runs the unit tests.  If the tests pass, then the Heroku deploy workflow starts.</p>
<p>The two stages can be seen in the dashboard as the pipeline runs.</p>
<p><img src="../../images/circle-ci-status-monitor-pipelines-heroku-orb.png" alt="CircleCI dashboard - status monitor service pipeline - build and deploy to Heroku"></p>
<p>Now visit the deployed Heroku application to see it in action.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If there are issues, then use the Heroku toolbelt to look at the logs.  In a command line terminal, issue the login command which opens a web browser to login to Heroku.  Once logged in, run the heroku logs command to view the latest logs</p>
<pre class="language-"><code class="lang-bash">heroku login

heroku logs --app banking-on-clojure
</code></pre>
<p>The logs can also be viewed live, as the application is being deployed by including the <code>--tail</code> option when running the heroku logs command in a terminal</p>
<pre class="language-"><code class="lang-bash">heroku logs --app banking-on-clojure --tail
</code></pre>
<p>The example Heroku logs show that the banking-on-clojure is using the default port number if non is supplied as an argument, rather than Heroku assigned port.  Heroku therefore considers the application as unresponsive and sets it status to crashed, tearing down the container the application is running in.</p>
<p>These logs were generated before adding the <code>$PORT</code> to the command in the Procfile.</p>
<p><img src="../../images/heroku-logs-status-monitor-process-crashed-wrong-port-number.png" alt="Heroku logs - status-monitor-service using incorrect port rather than Heroku assigned port so the application was considered unresponsive and crashed"></p>
<h2 id="no-forced-pushes">No forced pushes</h2>
<p>Heroku doesnt like force Git pushes coming via CircleCI.</p>
<p><img src="../../images/circle-ci-heroku-orb-no-forced-push.png" alt="CircleCI Heroku orb no forced push"></p>
<p>To get around this, either dont do force pushes to GitHub, or add the Heroku repositor for the project as a remote to local git repository.</p>
<p>Heroku repository details in heroku dashboard <strong>Settings</strong> under <strong>App Information</strong></p>
<p>Changes can now be pushed, ideally using <code>force-with-lease</code> to Heroku repository.</p>
<pre class="language-"><code class="lang-bash"><span class="token function">git</span> push heroku live:master
</code></pre>
<blockquote>
<p>Heroku only builds from a branch called master, so the above command pushes the local <code>live</code> branch to the remote <code>master</code> branch on Heroku.</p>
</blockquote>
<h2 id="stopping-the-application">Stopping the application</h2>
<p>An application can be run for free on Heroku with the monthly free credits provided.  However, to make the most out of these free credits then applications not in use should be shut down</p>
<p>Run the following command in the root of the Clojure project.</p>
<pre class="language-"><code class="lang-bash">heroku ps:stop banking-on-clojure
</code></pre>
 <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css"> <script>     window.klipse_settings = {         selector: ".language-klipse, .lang-eval-clojure",         selector_eval_js: ".lang-eval-js",         selector_eval_python_client: ".lang-eval-python",         selector_eval_php: ".lang-eval-php",         selector_eval_scheme: ".lang-eval-scheme",         selector_eval_ruby: ".lang-eval-ruby",         selector_reagent: ".lang-reagent",        selector_google_charts: ".lang-google-chart",        selector_es2017: ".lang-eval-es2017",        selector_jsx: ".lang-eval-jsx",        selector_transpile_jsx: ".lang-transpile-jsx",        selector_render_jsx: ".lang-render-jsx",        selector_react: ".lang-react",        selector_eval_markdown: ".lang-render-markdown",        selector_eval_lambdaway: ".lang-render-lambdaway",        selector_eval_cpp: ".lang-eval-cpp",        selector_eval_html: ".lang-render-html",        selector_sql: ".lang-eval-sql",        selector_brainfuck: "lang-eval-brainfuck",        selector_js: ".lang-transpile-cljs"    }; </script> <script src="https://storage.googleapis.com/app.klipse.tech/plugin/js/klipse_plugin.js"></script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="deployment-pipeline.html" class="navigation navigation-prev " aria-label="Previous page: Deployment Pipeline">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="unit-tests.html" class="navigation navigation-next " aria-label="Next page: Unit Tests">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deployment via CI to Heroku","level":"2.2.6","depth":2,"next":{"title":"Unit Tests","level":"2.2.7","depth":2,"path":"projects/banking-on-clojure/unit-tests.md","ref":"projects/banking-on-clojure/unit-tests.md","articles":[]},"previous":{"title":"Deployment Pipeline","level":"2.2.5","depth":2,"path":"projects/banking-on-clojure/deployment-pipeline.md","ref":"projects/banking-on-clojure/deployment-pipeline.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchor-headings-lambda","callouts","codeblock-disable-glossary","disqus","folding-chapters","ga","-glossary","-highlight","klipse","newtabs","prism","sectionx","simpletabs","-sharing","splitter","terminull-light","theme-jr0cket","toggle-chapters","toolbar","youtube","wide-page"],"styles":{"website":"styles/website.css","ebook":"styles/ebook.css","pdf":"styles/pdf.css","mobi":"styles/mobi.css","epub":"styles/epub.css"},"pluginsConfig":{"prism":{},"disqus":{"useIdentifier":false,"shortName":"clojure-webapps-practicalli"},"callouts":{"showTypeInHeader":false,"star":{"alert":"warning","picto":"fa-star"}},"youtube":{},"splitter":{},"search":{},"wide-page":{},"anchor-headings-lambda":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"terminull-light":{},"simpletabs":{},"codeblock-disable-glossary":{},"fontsettings":{"theme":"white","family":"sans","size":2},"folding-chapters":{},"sectionx":{"tag":"b"},"ga":{"configuration":"auto","token":"UA-28030709-8"},"klipse":{"myConfigKey":"it's the default value"},"theme-jr0cket":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"toolbar":{"buttons":[{"label":"Clojurians Slack","icon":"fa fa-comments-o","url":"http://clojurians.slack.com/messages/practicalli"},{"label":"GitHub","icon":"fa fa-github","url":"https://github.com/practicalli/clojure-webapps-content/issues"}]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"newtabs":{},"toggle-chapters":{}},"theme":"default","author":"Practicalli","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"P9IDeveloperGuides":"https://github.com/jr0cket/developer-guides/raw/master/","P9IPullRequestsUrl":"https://github.com/practicalli/clojure-webapps-content/pulls","P9IClojureDepsEdn":"https://github.com/practicalli/clojure-deps-edn","KeyDownArrow":"<kbd>â</kbd>","host":"practical.li","KeyCtrl":"<kbd>Ctrl</kbd>","Leiningen":"https://leiningen.org/","P9IClojureThroughCode":"https://github.com/practicalli/clojure-through-code","KeyUpArrow":"<kbd>â</kbd>","P9IIssuesUrl":"https://github.com/practicalli/clojure-webapps-content/issues","KeyEsc":"<kbd>Esc</kbd>","KeyEnter":"<kbd>Enter</kbd>","website":"https://practical.github.io/clojure","P9IFourClojure":"https://practical.github.io/clojure"},"title":"Practicalli Clojure WebApps","links":{"sidebar":{"Practical.li":"https://practicalli.github.io"}},"gitbook":">=3.0.0","description":"Server-side applications and APIs in Clojure"},"file":{"path":"projects/banking-on-clojure/deployment-via-ci.md","mtime":"2021-08-21T13:47:03.090Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-08-21T13:48:21.058Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>


        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchor-headings-lambda/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codeblock-disable-glossary/disable-glossary.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-folding-chapters/folding-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-newtabs/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-newtabs/tabs.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-simpletabs/tabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-terminull-light/terminull.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

        
    </body>
</html>

